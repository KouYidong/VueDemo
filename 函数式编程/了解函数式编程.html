<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>了解函数式编程</title>
</head>

<body>
  <script>
    /*
      面向对象编程(OOP)通过封装变化使得代码更易理解
      函数式编程(FP)通过最小化变化使得代码更易理解

      设计应用程序时的设计原则：
      1. 可扩展性，我是否需要不断重构代码来支持额外的功能
      2. 易模块化，如果我更改了一个文件，另一个文件是否会受到影响
      3. 可重用性，是否有很多重复的代码
      4. 可测性，给这些函数添加单元测试是否让我纠结
      5. 易推理性，我写的代码是否非结构化严重并难以推理

      函数式编程的目的：
        使用函数来抽象作用在数据之上的控制流和操作，
        从而在系统中消除副作用并减少对状态的改变

      基本概念：
        1. 声明式编程
        2. 纯函数
        3. 引用透明
        4. 不可变性
    */

    /* *********************声明式编程*********************** */
    /* 
      函数式编程属于声明式编程范式：
        这种范式会描述一些列的操作，
        但并不会暴露它们是如果实现的或是数据流如何传过它们
    */
    // 命令式方式
    var array = [0, 1, 2, 3]
    for (let i = 0; i < array.length; i++) {
      array[i] = Math.pow(array[i], 2)
    }
    array; // [0, 1, 4, 9]

    // 声明式方式
    [0, 1, 2, 3].map(num => Math.pow(num, 2))
    /* 
      个人理解为只告诉程序要干什么，而不用告诉怎么做
      函数式编程主旨：
        在尽可能的提高代码的无状态性和不变性
        要做到这一点就要学会使用无副作用的函数--纯函数

    /* *********************纯函数*********************** */
    /* 
      纯函数：
        没有副作用的函数，相同的输入有相同的输出

      会产生副作用的情况：
        1. 改变一个全局的变量、属性或数据结构
        2. 改变一个函数参数的原始值
        3. 处理用户输入
        4. 抛出一个异常
        5. 屏幕打印或记录日志
        6. 查询HTML文档，浏览器的Cookie或访问数据库
    */

    // 非纯函数
    var counter = 0;
    function increment() {
      return ++counter;
    }

    /*
      纯函数有一下性质：
        1. 仅取决于提供的输入，而不依赖于任何在函数求值或间隔时
           可能变化的隐藏状态和外部状态
        2. 不会造成超出作用域的变化，例如修改全局变量或引用传递的参数
      但是在开发时，难免有一些副作用，与外部的存储系统或DOM交互等，
      但是我们可以通过将其从主逻辑中分离出来，使他们易于管理
    */
    /*
      现在我们有一个小需求：
        通过 id 找到学生的记录并渲染在浏览器
        (在写程序的时候要想到可能也会写到控制台，
        数据库或者文件，所以要想如何让自己的代码能重用)中。
    */
    // 函数式代码
    //   通过find函数找到学生
    //   var find = curry(function(db, id) {
    //     var obj = db.get(id);
    //     if (obj === null) {
    //       throw new Error('not fount');
    //     }
    //     return obj;
    //   });

    //   // 将学生对象format
    //   var csv = (student) => `${student.id}, ${student.name}, ${student.lastname}`;

    //   // 在屏幕上显示
    //   var append = curry(function(elementId, info) {
    //     document.querySelector(elementId).innerHTML = info;
    //   });

    //   var showStudent = compose(append('#student-info'), csv, find(db));

    //   showStudent('666');

    /*
      以上利用了柯里化，可以看出函数式编程的优势：
      1. 灵活，有三个可重用的组件
      2. 声明式的风格，给高阶步骤提供了一个清晰视图，增强了代码的可读性
      3. 另外是将纯函数与不纯的行为分离出来
    */

    /* *********************引用透明*********************** */
    /*
      引用透明：
        定义一个纯函数较为正确的方法。
        纯度在这个意义上表示一个函数的参数和返回值之间映射的纯的关系。
        如果一个函数对于相同的输入始终产生相同的结果，那么这就是引用透明
    */
    //  非引用透明
    var counter1 = 0;
    function increment1() {
      return ++counter;
    }
    // 引用透明
    var increment2 = (counter) => counter + 1;

    /* 
      箭头函数在函数式编程中有一个高大上的名字，
      叫lambda表达式，对于这种匿名函数在学术上就是叫lambda表达式，
      仔仔在java里面也是支持的。
    */

    /* *********************不可变数据*********************** */
    /* 
      不可变数据是指那些创建后不能更改的数据。
      与许多其他语言一样，JavaScript 里有一些基本类型(String,Number 等)
      从本质上是不可变的，但是对象就是在任意的地方可变。
    */
    //  数组排序代码
    var sortDesc = function (arr) {
      return arr.sort(function (a, b) {
        return a - b
      })
    }

    var arr = [1, 3, 2]
    sortDesc(arr) // [1, 2, 3]
    arr // [1, 2, 3]
    /* 
    这段代码看似没什么问题，但是会导致在排序的过程中会产生副作用，
    修改了原始引用，可以看到原始的 arr 变成了 [1, 2, 3]。
    这是一个语言缺陷。  
    */

    /* *********************总结*********************** */
    /* 
      1. 使用纯函数的代码绝不会更改或破坏全局状态，
         有助于提高代码的可测试性和可维护性
      2. 函数式编程采用声明式的风格，易于推理，提高代码的可读性。
      3. 函数式编程将函数视为积木，通过一等高阶函数来提高代码的模块化和可重用性。
      4. 可以利用响应式编程组合各个函数来降低事件驱动程序的复杂性。
    */
  </script>
</body>

</html>